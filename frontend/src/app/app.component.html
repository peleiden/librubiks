<div class="content">
  <div class="row">
    <h1 class="col-10">Solving Rubik's Cube with Reinforcement Learning</h1>
    <span class="col-2" *ngIf="commonService.status.hasData">
      <p>Server</p>
      <select [ngModel]="httpService.selectedHost" (ngModelChange)="commonService.setSelectedHost($event)">
        <option *ngFor="let host of httpService.hosts" [ngValue]="host">{{host.name}}</option>
      </select>
    </span>
  </div>
  <div class="row" *ngIf="!(commonService.status.loading && !commonService.status.hasData) else loading">
    <div class="col-5">
      <p>
        Developed by Asger Schultz (<a href="mailto:s183912@student.dtu.dk">s183912@student.dtu.dk</a>),
        SÃ¸ren Winkel Holm (<a href="mailto:s183911@student.dtu.dk">s183911@student.dtu.dk</a>), and
        Anne Agathe Pedersen (<a href="mailto:s174300@student.dtu.dk">s174300@student.dtu.dk</a>).
        Repository available on <a href="https://github.com/peleiden/rl-rubiks">GitHub</a>.
      </p>

      <h2 class="h5 mt-4">Perform action</h2>
      <!-- Actions -->
      <div style="max-width: 450px;">
        <div class="row my-1">
          <div class="col-2" *ngFor="let i of [0, 2, 4, 6, 8, 10]">
            <button class="btn btn-secondary btn-action"
                    (click)="cubeService.inplaceRotate(cubeService.actionSpace[i][0], cubeService.actionSpace[i][1])"
                    [disabled]="commonService.status.loading">
              {{cubeService.actions[i]}}
            </button>
          </div>
        </div>
        <div class="row my-1">
          <div class="col-2" *ngFor="let i of [1, 3, 5, 7, 9, 11]">
            <button class="btn btn-secondary btn-action"
                    (click)="cubeService.inplaceRotate(cubeService.actionSpace[i][0], cubeService.actionSpace[i][1])"
                    [disabled]="commonService.status.loading">
              {{cubeService.actions[i]}}
            </button>
          </div>
        </div>
      </div>
      <!-- Reset -->
      <button class="btn btn-secondary my-1" (click)="cubeService.reset()" [disabled]="commonService.status.loading">Reset</button>
      <!-- Scrambling -->
      <form class="form-inline my-1" (ngSubmit)="commonService.scramble(scrambleDepth)">
        <button class="btn btn-secondary" type="submit" [disabled]="commonService.status.loading">Perform</button>
        <div class="form-group mx-2">
          <input type="number" class="form-control" style="width: 6rem;" [(ngModel)]="scrambleDepth" [ngModelOptions]="{standalone: true}">
        </div>
        random actions.
      </form>

      <h2 class="h5 mt-4">Agents</h2>
      <p>All agents create an an action queue, which if followed produces the solved states, insofar as it was found.</p>
      <p *ngIf="!commonService.cuda">
        Be aware that CUDA is not available on the selected server. Agents depending on a neural network will need more time to search for good results.
      </p>
      <p *ngIf="!commonService.cuda && httpService.selectedHost.name !== 'Local'">
        If CUDA is available on your machine, you can start start a local server by running the src/api.py script.
      </p>
      <form class="form-inline" (ngSubmit)="commonService.solve()">
        <button type="submit" class="btn btn-secondary mr-2" [disabled]="commonService.status.loading">Try</button>
        to solve in
        <div class="form-group mx-2">
          <input type="number"
                 class="form-control"
                 style="width: 6rem;"
                 [(ngModel)]="commonService.timeLimit"
                 [ngModelOptions]="{standalone: true}">
        </div>
        seconds with
        <select class="my-2 ml-2" [(ngModel)]="commonService.selectedSearcher" [ngModelOptions]="{standalone: true}">
          <option *ngFor="let searcher of commonService.searchers; let i = index" [ngValue]="i">{{searcher}}</option>
        </select>
      </form>
      <div *ngIf="commonService.hasSearchedForSolution" class="mt-2">
        <p>
          {{commonService.exploredStates || "A number of"}} states were explored,
          <span *ngIf="commonService.hasSolution">and a solution of {{commonService.solveLength}} steps was found.</span>
          <span *ngIf="!commonService.hasSolution">but a solution was not found.</span>
        </p>
        <p *ngIf="commonService.hasSolution"></p>
        <div *ngIf="commonService.hasSolution && commonService.actionQueue.length">
          <p>Actions to solution: {{commonService.prettyActionQueue}}</p>
          <button class="btn btn-secondary mr-2" (click)="commonService.step(commonService.actionQueue.pop())">Perform one action</button>
          <button class="btn btn-secondary" (click)="commonService.animateStates()">Perform remaining actions</button>
        </div>
      </div>
    </div>

    <div class="col-7">
      <div style="height: 50px;"></div>
      <app-rubiks></app-rubiks>
      <div style="height: 50px;"></div>
      <div class="loader" style="padding-right: 100px;" *ngIf="commonService.status.loading"></div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="loader"></div>
</ng-template>
